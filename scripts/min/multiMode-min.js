define(["jquery"],function(e){e.fn.multiMode=function(t){function i(){this.code="var r = [];\n"}var r={mode:"abstract",template:"",_class:"",removeClass:"",data:[],beforeInit:null,afterInit:null};t=e.extend({},r,t);var n=e(this);i.prototype.conditions=function(e,t,i,r){var n="",s=/^#[if|else|list|\/if|\/list]+/,l=/[if|else|list|\/if|\/list]+/,a=this;if(i)if(s.test(t)){switch(t=t.substring(1),t.match(l)[0]){case"if":var o=/\([^\)]+\)/,c=t.match(o)[0];if(c=c.replace(/\(|\)/g,""),c.indexOf("==")>=0||c.indexOf("===")>=0){var f=null,h="";c.indexOf("===")>=0?(f=c.split("==="),h="==="):(f=c.split("=="),h="==");for(var p=0;p<f.length;p++){var u=f[p];e[u]&&(f[p]=e[u])}t="if("+f[0]+h+f[1]+")"}else t=t.replace(o,"("+e[c]+")");n+=t+"{";break;case"/if":n+="}";break;case"else":n+="}"+t+"{";break;case"list":for(var c=t.replace(/\s+/g," ").split(" ")[1],p=0;p<e.length;p++){var d=e[p];n+=a.replaceStr(d,r)}break;case"/list":n+="}"}n+="\n"}else n+='r.push("'+e[t]+'");\n;';else n+=""!=t?'r.push("'+t.replace(/"/g,'\\"')+'");\n':"";return n},i.prototype.replaceStr=function(e,i){i=i?i:0;for(var r=t.template.substring(i),n=/\{([^\}]+)?\}/g,s=null,l=0,a="";s=n.exec(r);)i=s.index+s[0].length,a+=this.conditions(e,r.slice(l,s.index)),a+=this.conditions(e,s[1],!0,i),l=s.index+s[0].length;a+=this.conditions(e,r.substr(l,r.length-l)),this.code+=a,console.log(this.code)},i.prototype.checkArrayOrJson=function(t){var i="",r=null;if(e.isArray(t)&&t.length){t.length;this.replaceStr(t),this.code+='return r.join("")',r=new Function(this.code.replace(/\n\r\t/g,"")),i=r()}else i+=this.replaceStr(t);return i},i.prototype.buildHtml=function(){var e=t.data,i="",r=this;return e instanceof Object?i=r.checkArrayOrJson(e):"string"==typeof e&&(e=JSON.parse(e),i=r.checkArrayOrJson(e)),i},i.prototype.init=function(){t.beforeInit&&t.beforeInit(),n.addClass(t._class).removeClass(t.removeClass).html(this.buildHtml()),t.afterInit&&t.afterInit()};var s=new i;s.init()}});